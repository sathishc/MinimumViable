/*
* Print Element Plugin 1.2
*
* Copyright (c) 2010 Erik Zaadi
*
* Inspired by PrintArea (http://plugins.jquery.com/project/PrintArea) and
* http://stackoverflow.com/questions/472951/how-do-i-print-an-iframe-from-javascript-in-safari-chrome
*
*  Home Page : http://projects.erikzaadi/jQueryPlugins/jQuery.printElement 
*  Issues (bug reporting) : http://github.com/erikzaadi/jQueryPlugins/issues/labels/printElement
*  jQuery plugin page : http://plugins.jquery.com/project/printElement 
*  
*  Thanks to David B (http://github.com/ungenio) and icgJohn (http://www.blogger.com/profile/11881116857076484100)
*  For their great contributions!
* 
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*   
*   Note, Iframe Printing is not supported in Opera and Chrome 3.0, a popup window will be shown instead
*/

(function(e){function t(e){e&&e.printPage?e.printPage():setTimeout(function(){t(e)},50)}function n(e){return e=s(e),s(":checked",e).each(function(){this.setAttribute("checked","checked")}),s("input[type='text']",e).each(function(){this.setAttribute("value",s(this).val())}),s("select",e).each(function(){var e=s(this);s("option",e).each(function(){e.val()==s(this).val()&&this.setAttribute("selected","selected")})}),s("textarea",e).each(function(){var e=s(this).attr("value");s.browser.b&&this.firstChild?this.firstChild.textContent=e:this.innerHTML=e}),s("<div></div>").append(e.clone()).html()}function r(t,r){var o=s(t);t=n(t);var u=[];u.push("<html><head><title>"+r.pageTitle+"</title>");if(r.overrideElementCSS){if(r.overrideElementCSS.length>0)for(var f=0;f<r.overrideElementCSS.length;f++){var c=r.overrideElementCSS[f];typeof c=="string"?u.push('<link type="text/css" rel="stylesheet" href="'+c+'" >'):u.push('<link type="text/css" rel="stylesheet" href="'+c.href+'" media="'+c.media+'" >')}}else s("link",i).filter(function(){return s(this).attr("rel").toLowerCase()=="stylesheet"}).each(function(){u.push('<link type="text/css" rel="stylesheet" href="'+s(this).attr("href")+'" media="'+s(this).attr("media")+'" >')});return u.push('<base href="'+(e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")+e.location.pathname)+'" />'),u.push('</head><body style="'+r.printBodyOptions.styleToAdd+'" class="'+r.printBodyOptions.classNameToAdd+'">'),u.push('<div class="'+o.attr("class")+'">'+t+"</div>"),u.push('<script type="text/javascript">function printPage(){focus();print();'+(!s.browser.opera&&!r.leaveOpen&&r.printMode.toLowerCase()=="popup"?"close();":"")+"}</script>"),u.push("</body></html>"),u.join("")}var i=e.document,s=e.jQuery;s.fn.printElement=function(n){var o=s.extend({},s.fn.printElement.defaults,n);return o.printMode=="iframe"&&(s.browser.opera||/chrome/.test(navigator.userAgent.toLowerCase()))&&(o.printMode="popup"),s("[id^='printElement_']").remove(),this.each(function(){var n=s.a?s.extend({},o,s(this).data()):o,u=s(this);u=r(u,n);var f=null,l=null;if(n.printMode.toLowerCase()=="popup")f=e.open("about:blank","printElementWindow","width=650,height=440,scrollbars=yes"),l=f.document;else{f="printElement_"+Math.round(Math.random()*99999).toString();var c=i.createElement("IFRAME");s(c).attr({style:n.iframeElementOptions.styleToAdd,id:f,className:n.iframeElementOptions.classNameToAdd,frameBorder:0,scrolling:"no",src:"about:blank"}),i.body.appendChild(c),l=c.contentWindow||c.contentDocument,l.document&&(l=l.document),c=i.frames?i.frames[f]:i.getElementById(f),f=c.contentWindow||c}focus(),l.open(),l.write(u),l.close(),t(f)})},s.fn.printElement.defaults={printMode:"iframe",pageTitle:"",overrideElementCSS:null,printBodyOptions:{styleToAdd:"padding:10px;margin:10px;",classNameToAdd:""},leaveOpen:!1,iframeElementOptions:{styleToAdd:"border:none;position:absolute;width:0px;height:0px;bottom:0px;left:0px;",classNameToAdd:""}},s.fn.printElement.cssElement={href:"",media:""}})(window);